import socket

import pickle

import numpy as np

import time

import struct

def recv_all(sock, count):

Â Â Â Â Â Â Â Â buf = b''

Â Â Â Â Â Â Â Â while len(buf) < count:

Â  Â  Â Â Â Â Â Â Â Â to_read = min(4096, count - len(buf))

Â  Â  Â Â Â Â Â Â Â Â newbuf = sock.recv(to_read)

Â  Â  Â Â Â Â Â Â Â Â if not newbuf:

Â  Â  Â  Â  Â Â Â Â Â Â Â Â raise ConnectionError("ConexÃ£o encerrada antes de receber todos os dados")

Â  Â  Â Â Â Â Â Â Â Â buf += newbuf

Â Â Â Â Â Â Â Â return buf

PORT = 6000

tcp = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

tcp.bind(('', PORT))

tcp.listen(5)

print("p3 aguardando matrizes de p2...")

while True:

Â Â Â Â Â Â Â Â con, addr = tcp.accept()

Â Â Â Â Â Â Â Â print("ğŸ”· ConexÃ£o recebida de p2.")

Â Â Â Â Â Â Â Â try:

Â  Â  Â Â Â Â Â Â Â Â size_data = recv_all(con, 8)

Â  Â  Â Â Â Â Â Â Â Â size = struct.unpack('>Q', size_data)[0]

Â  Â  Â Â Â Â Â Â Â Â data = recv_all(con, size)

Â  Â  Â Â Â Â Â Â Â Â pacote = pickle.loads(data)

Â Â Â Â Â Â Â Â except Exception as e:

Â  Â  Â Â Â Â Â Â Â Â print(f"âŒ Erro ao receber: {e}")

Â  Â  Â Â Â Â Â Â Â Â con.close()

Â  Â  Â Â Â Â Â Â Â Â continue

Â Â Â Â Â Â Â Â con.close()

Â Â Â Â Â Â Â Â matriz = pacote['matriz']

Â Â Â Â Â Â Â Â start_time = pacote['start_time']

Â Â Â Â Â Â Â Â determinante = np.linalg.det(matriz)

Â Â Â Â Â Â Â Â tempo_total = time.time() - start_time

Â Â Â Â Â Â Â Â print("\nâœ… Matriz recebida:")

Â Â Â Â Â Â Â Â print(matriz)

Â Â Â Â Â Â Â Â print(f"\nğŸ“ Determinante: {determinante}")

Â Â Â Â Â Â Â Â print(f"â±ï¸ Tempo total (segundos): {round(tempo_total, 4)}")


